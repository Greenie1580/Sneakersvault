<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dan's Sneaker Collection</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0a;
    --surface: #111111;
    --surface2: #1a1a1a;
    --border: #2d2d2d;
    --orange: #CE1141;
    --orange-dim: rgba(206, 17, 65, 0.12);
    --orange-glow: rgba(206, 17, 65, 0.4);
    --text: #ffffff;
    --text-dim: #999;
    --green: #22c55e;
    --red: #CE1141;
    --blue: #ffffff;
    --purple: #CE1141;
    --radius: 14px;
    --radius-sm: 8px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 28px;
    background: var(--surface);
    border-bottom: 3px solid var(--orange);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
    box-shadow: 0 4px 24px rgba(206,17,65,0.15);
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: #ffffff;
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo span { color: var(--orange); }
  .logo-icon { font-size: 1.6rem; }

  .header-actions { display: flex; gap: 10px; align-items: center; }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 18px;
    border-radius: var(--radius-sm);
    border: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s;
  }
  .btn-primary { background: var(--orange); color: #fff; }
  .btn-primary:hover { background: #e8184f; transform: translateY(-1px); box-shadow: 0 6px 20px var(--orange-glow); }
  .btn-ghost { background: transparent; color: var(--text-dim); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--orange); color: var(--orange); }
  .btn-danger { background: var(--red); color: #fff; }
  .btn-danger:hover { background: #f87171; }

  /* NAV TABS */
  nav {
    display: flex;
    gap: 4px;
    padding: 12px 28px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }

  .nav-tab {
    padding: 8px 20px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-dim);
    transition: all 0.2s;
    border: none;
    background: none;
    font-family: 'DM Sans', sans-serif;
    display: flex;
    align-items: center;
    gap: 7px;
  }
  .nav-tab:hover { color: var(--text); background: var(--surface2); }
  .nav-tab.active { background: var(--orange-dim); color: #ffffff; border-bottom: 2px solid var(--orange); }
  .badge {
    background: var(--orange);
    color: #fff;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 99px;
    min-width: 18px;
    text-align: center;
  }

  /* MAIN LAYOUT */
  main { padding: 28px; max-width: 1200px; margin: 0 auto; }

  .page { display: none; animation: fadeIn 0.25s ease; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* SEARCH & FILTER BAR */
  .toolbar {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
    align-items: center;
  }

  .search-wrap {
    position: relative;
    flex: 1;
    min-width: 200px;
  }
  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-dim);
    font-size: 1rem;
  }
  input[type="text"], input[type="number"], textarea, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    transition: border-color 0.2s;
  }
  input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
    outline: none;
    border-color: var(--orange);
  }
  .search-input {
    width: 100%;
    padding: 11px 14px 11px 40px;
  }

  .filter-chips { display: flex; gap: 8px; flex-wrap: wrap; }
  .chip {
    padding: 7px 16px;
    border-radius: 99px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--text-dim);
    transition: all 0.2s;
  }
  .chip:hover { border-color: var(--orange); color: var(--orange); }
  .chip.active { background: var(--orange); border-color: var(--orange); color: #fff; }

  /* SNEAKER GRID */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 18px;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    cursor: pointer;
    transition: all 0.25s;
    position: relative;
  }
  .card:hover {
    border-color: var(--orange);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(206,17,65,0.25), 0 0 0 1px var(--orange);
  }

  .card-img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    display: block;
    background: var(--surface2);
  }
  .card-img-placeholder {
    width: 100%;
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #1a1a1a, #222);
    font-size: 3.5rem;
  }

  .card-body { padding: 16px; }
  .card-brand {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    color: var(--orange);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 4px;
  }
  .card-model { font-weight: 700; font-size: 1rem; margin-bottom: 3px; line-height: 1.2; }
  .card-colorway { color: var(--text-dim); font-size: 0.8rem; margin-bottom: 12px; }

  .card-tags { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 12px; }
  .tag {
    padding: 2px 9px;
    border-radius: 99px;
    font-size: 0.7rem;
    font-weight: 600;
    background: var(--orange-dim);
    color: var(--orange);
    border: 1px solid rgba(255,107,26,0.25);
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }
  .card-value { font-size: 1.2rem; font-weight: 700; }
  .card-pl {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 6px;
  }
  .card-pl.positive { background: rgba(34,197,94,0.15); color: var(--green); }
  .card-pl.negative { background: rgba(239,68,68,0.15); color: var(--red); }
  .card-pl.neutral { background: var(--surface2); color: var(--text-dim); }

  .wishlist-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border-radius: 99px;
    padding: 4px 8px;
    font-size: 0.8rem;
    backdrop-filter: blur(6px);
  }

  /* EMPTY STATE */
  .empty {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-dim);
  }
  .empty-icon { font-size: 4rem; margin-bottom: 16px; opacity: 0.4; }
  .empty h3 { font-size: 1.3rem; color: var(--text); margin-bottom: 8px; }
  .empty p { margin-bottom: 24px; }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    z-index: 200;
    backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 560px;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }
  @keyframes slideUp { from { opacity: 0; transform: scale(0.94) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 22px 24px 0;
  }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 1px; }
  .modal-close {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text-dim);
    width: 34px;
    height: 34px;
    border-radius: 99px;
    cursor: pointer;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .modal-close:hover { border-color: var(--red); color: var(--red); }

  .modal-body { padding: 20px 24px 24px; }

  /* FORM */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-group.full { grid-column: 1 / -1; }
  label { font-size: 0.75rem; font-weight: 600; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.8px; }
  input[type="text"], input[type="number"] { padding: 11px 14px; width: 100%; }
  textarea { padding: 11px 14px; width: 100%; resize: vertical; min-height: 80px; }

  .photo-upload {
    width: 100%;
    height: 140px;
    border: 2px dashed var(--border);
    border-radius: var(--radius-sm);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    background: var(--surface2);
  }
  .photo-upload:hover { border-color: var(--orange); }
  .photo-upload img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
  .photo-upload-text { color: var(--text-dim); font-size: 0.85rem; text-align: center; position: relative; }
  .photo-upload-icon { font-size: 1.8rem; margin-bottom: 6px; }
  #photoInput { display: none; }

  .form-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  /* DETAIL MODAL */
  .detail-hero {
    width: 100%;
    height: 240px;
    object-fit: cover;
    display: block;
    border-radius: 14px 14px 0 0;
  }
  .detail-hero-placeholder {
    width: 100%;
    height: 240px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #1a1a1a, #252525);
    font-size: 5rem;
    border-radius: 14px 14px 0 0;
  }
  .detail-brand {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    color: var(--orange);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 6px;
  }
  .detail-name { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 1px; margin-bottom: 4px; }
  .detail-colorway { color: var(--text-dim); margin-bottom: 20px; }

  .value-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px; }
  .value-box {
    padding: 14px;
    border-radius: var(--radius-sm);
    background: var(--surface2);
    border: 1px solid var(--border);
    text-align: center;
  }
  .value-box-label { font-size: 0.7rem; color: var(--text-dim); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; }
  .value-box-val { font-size: 1.3rem; font-weight: 700; }

  .detail-section { margin-bottom: 16px; }
  .detail-section h4 { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 8px; }
  .detail-note {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    font-size: 0.9rem;
    color: var(--text-dim);
    line-height: 1.6;
  }
  .detail-barcode {
    font-family: 'Space Mono', monospace;
    font-size: 0.85rem;
    color: var(--text-dim);
  }

  /* STATS */
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 30px; }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 22px;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s;
  }
  .stat-card:hover { transform: translateY(-2px); }
  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }
  .stat-card.orange::before { background: var(--orange); }
  .stat-card.green::before { background: var(--green); }
  .stat-card.blue::before { background: #ffffff; }
  .stat-card.purple::before { background: var(--orange); }
  .stat-card.red::before { background: var(--orange); }

  .stat-icon { font-size: 1.5rem; margin-bottom: 12px; }
  .stat-val { font-family: 'Bebas Neue', sans-serif; font-size: 2.4rem; letter-spacing: 1px; margin-bottom: 2px; }
  .stat-label { font-size: 0.8rem; color: var(--text-dim); font-weight: 500; }

  .chart-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
  }
  .chart-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 1px; margin-bottom: 20px; color: var(--text-dim); }

  .brand-bar-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 14px;
  }
  .brand-bar-label { font-size: 0.82rem; font-weight: 600; width: 100px; flex-shrink: 0; }
  .brand-bar-track { flex: 1; height: 10px; background: var(--surface2); border-radius: 99px; overflow: hidden; }
  .brand-bar-fill { height: 100%; background: var(--orange); border-radius: 99px; transition: width 0.5s ease; }
  .brand-bar-count { font-size: 0.8rem; color: var(--orange); font-weight: 700; width: 30px; text-align: right; }

  /* SCANNER */
  .scanner-area {
    background: var(--surface2);
    border: 1px dashed var(--border);
    border-radius: var(--radius-sm);
    padding: 20px;
    text-align: center;
    margin-bottom: 10px;
  }
  #video { width: 100%; border-radius: 8px; display: none; }
  #scanBtn { margin-top: 10px; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #444; }

  /* RESPONSIVE */
  @media (max-width: 600px) {
    header { padding: 14px 16px; }
    nav { padding: 10px 16px; overflow-x: auto; }
    main { padding: 16px; }
    .form-grid { grid-template-columns: 1fr; }
    .value-row { grid-template-columns: 1fr 1fr; }
    .stat-val { font-size: 1.8rem; }
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 1px; color: var(--text-dim); }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <span class="logo-icon">
      <svg width="38" height="28" viewBox="0 0 120 80" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:inline-block;vertical-align:middle;">
        <!-- Sole -->
        <ellipse cx="58" cy="68" rx="52" ry="9" fill="#111111" stroke="#CE1141" stroke-width="1.5"/>
        <!-- Midsole white strip -->
        <rect x="10" y="60" width="100" height="10" rx="4" fill="#ffffff"/>
        <!-- Main upper - black base -->
        <path d="M18 60 C18 60 12 45 15 32 C18 20 28 14 40 12 C52 10 62 10 72 12 C82 14 92 18 100 26 C108 34 110 45 110 60 Z" fill="#111111"/>
        <!-- Red swoosh-style side panel -->
        <path d="M22 54 C28 42 36 34 48 28 C60 22 74 20 88 26 C96 30 104 38 108 48 C96 44 80 42 64 44 C48 46 34 50 22 54 Z" fill="#CE1141"/>
        <!-- Toe box - black -->
        <path d="M15 58 C15 50 18 40 26 34 C34 28 44 26 52 28 C46 34 38 42 32 52 C26 56 20 58 15 58 Z" fill="#111111" stroke="#CE1141" stroke-width="1"/>
        <!-- Ankle collar - red -->
        <path d="M72 12 C82 14 92 18 100 26 C104 30 108 38 110 52 L100 54 C98 42 92 32 84 26 C76 20 72 16 72 12 Z" fill="#CE1141"/>
        <!-- Tongue - white -->
        <path d="M52 12 C56 10 62 10 66 12 C68 18 68 28 66 36 C62 34 56 34 52 36 C50 28 50 18 52 12 Z" fill="#ffffff"/>
        <!-- Laces -->
        <line x1="53" y1="16" x2="65" y2="16" stroke="#CE1141" stroke-width="2" stroke-linecap="round"/>
        <line x1="52" y1="21" x2="66" y2="21" stroke="#CE1141" stroke-width="2" stroke-linecap="round"/>
        <line x1="52" y1="26" x2="66" y2="26" stroke="#CE1141" stroke-width="2" stroke-linecap="round"/>
        <line x1="52" y1="31" x2="66" y2="31" stroke="#CE1141" stroke-width="2" stroke-linecap="round"/>
        <!-- Nike Air text on sole -->
        <text x="38" y="67" font-family="Arial" font-size="6" fill="#CE1141" font-weight="bold">AIR</text>
      </svg>
    </span>
    Dan's Sneaker Collection
  </div>
  <div class="header-actions">
    <button class="btn btn-primary" onclick="openAddModal(false)">+ Add Sneaker</button>
  </div>
</header>

<!-- NAV -->
<nav>
  <button class="nav-tab active" onclick="switchTab('collection', this)">
    üëü Collection <span class="badge" id="collectionBadge">0</span>
  </button>
  <button class="nav-tab" onclick="switchTab('wishlist', this)">
    ‚ù§Ô∏è Wishlist <span class="badge" id="wishlistBadge">0</span>
  </button>
  <button class="nav-tab" onclick="switchTab('stats', this)">
    üìä Stats
  </button>
</nav>

<!-- MAIN -->
<main>

  <!-- COLLECTION PAGE -->
  <div id="page-collection" class="page active">
    <div class="toolbar">
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search brand, model, colorway‚Ä¶" oninput="renderCollection()">
      </div>
      <div class="filter-chips" id="filterChips"></div>
    </div>
    <div class="grid" id="collectionGrid"></div>
    <div class="empty" id="collectionEmpty" style="display:none">
      <div class="empty-icon">üëü</div>
      <h3>No Sneakers Yet</h3>
      <p>Start building your collection.</p>
      <button class="btn btn-primary" onclick="openAddModal(false)">+ Add Your First Pair</button>
    </div>
  </div>

  <!-- WISHLIST PAGE -->
  <div id="page-wishlist" class="page">
    <div class="section-header">
      <span class="section-title">Your Wishlist</span>
      <button class="btn btn-primary" onclick="openAddModal(true)">+ Add to Wishlist</button>
    </div>
    <div class="grid" id="wishlistGrid"></div>
    <div class="empty" id="wishlistEmpty" style="display:none">
      <div class="empty-icon">‚ù§Ô∏è</div>
      <h3>Wishlist is Empty</h3>
      <p>Add sneakers you're hunting for.</p>
      <button class="btn btn-primary" onclick="openAddModal(true)">+ Add Grail</button>
    </div>
  </div>

  <!-- STATS PAGE -->
  <div id="page-stats" class="page">
    <div class="stats-grid" id="statsGrid"></div>
    <div class="chart-section">
      <div class="chart-title">COLLECTION BY BRAND</div>
      <div id="brandChart"></div>
    </div>
  </div>

</main>

<!-- ADD/EDIT MODAL -->
<div class="modal-overlay" id="addModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle">ADD SNEAKER</span>
      <button class="modal-close" onclick="closeModal('addModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <!-- Photo -->
        <div class="form-group full">
          <label>Photo</label>
          <div class="photo-upload" onclick="document.getElementById('photoInput').click()" id="photoUploadArea">
            <div class="photo-upload-text">
              <div class="photo-upload-icon">üì∏</div>
              Click to upload a photo
            </div>
          </div>
          <input type="file" id="photoInput" accept="image/*" onchange="handlePhoto(event)">
        </div>
        <!-- Fields -->
        <div class="form-group">
          <label>Brand *</label>
          <input type="text" id="fBrand" placeholder="Nike, Jordan, Adidas‚Ä¶">
        </div>
        <div class="form-group">
          <label>Model *</label>
          <input type="text" id="fModel" placeholder="Air Force 1, Yeezy‚Ä¶">
        </div>
        <div class="form-group full">
          <label>Colorway</label>
          <input type="text" id="fColorway" placeholder="White/Black, Bred‚Ä¶">
        </div>
        <div class="form-group full">
          <label>Tags (comma separated)</label>
          <input type="text" id="fTags" placeholder="DS, Worn, Grail, Summer‚Ä¶">
        </div>
        <div class="form-group full">
          <label>ü§ñ AI Sneaker Identifier</label>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;">
            <p style="color:var(--text-dim);font-size:0.82rem;margin-bottom:10px;">Upload a photo of your sneaker and AI will identify the brand, model &amp; colorway automatically.</p>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn btn-primary" type="button" onclick="document.getElementById('aiPhotoInput').click()" style="flex:1;min-width:120px;">üì∏ Choose Photo</button>
              <button class="btn btn-ghost" type="button" id="aiIdentifyBtn" onclick="identifyWithAI()" style="flex:1;min-width:120px;" disabled>‚ú® Identify Sneaker</button>
            </div>
            <input type="file" id="aiPhotoInput" accept="image/*" capture="environment" onchange="handleAIPhoto(event)" style="display:none">
            <div id="aiStatus" style="margin-top:10px;font-size:0.82rem;color:var(--text-dim);display:none;"></div>
            <img id="aiPreview" style="width:100%;border-radius:8px;margin-top:10px;display:none;max-height:160px;object-fit:cover;">
          </div>
        </div>
        <div class="form-group full">
          <label>Notes</label>
          <textarea id="fNotes" placeholder="Story behind the pair, condition details‚Ä¶"></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-ghost" onclick="closeModal('addModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveSneaker()">Save Sneaker</button>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal" style="max-width:580px;">
    <div id="detailContent"></div>
  </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js"></script>
<script>
// ‚îÄ‚îÄ‚îÄ DATA LAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORAGE_KEY = 'kickvault_sneakers';

function loadSneakers() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch { return []; }
}

function saveSneakers(arr) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

let sneakers = loadSneakers();
let editingId = null;
let addingWishlist = false;
let currentPhoto = null;
let stream = null;

let activeFilter = 'All';

function getDynamicBrands() {
  const collection = sneakers.filter(s => !s.wishlist);
  const brands = [...new Set(collection.map(s => s.brand).filter(Boolean))].sort();
  return ['All', ...brands];
}

// ‚îÄ‚îÄ‚îÄ TAB NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(page, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  btn.classList.add('active');
  if (page === 'stats') renderStats();
  if (page === 'wishlist') renderWishlist();
}

// ‚îÄ‚îÄ‚îÄ FILTER CHIPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderFilterChips() {
  const brands = getDynamicBrands();
  // Reset filter to 'All' if current filter no longer exists
  if (!brands.includes(activeFilter)) activeFilter = 'All';
  const wrap = document.getElementById('filterChips');
  wrap.innerHTML = brands.map(b => `
    <div class="chip ${activeFilter === b ? 'active' : ''}" onclick="setFilter('${b}')">${b}</div>
  `).join('');
}

function setFilter(brand) {
  activeFilter = brand;
  renderFilterChips();
  renderCollection();
}

// ‚îÄ‚îÄ‚îÄ COLLECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCollection() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const collection = sneakers.filter(s => !s.wishlist);
  const filtered = collection.filter(s => {
    const matchSearch = !q || [s.brand, s.model, s.colorway, s.tags].join(' ').toLowerCase().includes(q);
    const matchFilter = activeFilter === 'All' || s.brand === activeFilter;
    return matchSearch && matchFilter;
  });

  const grid = document.getElementById('collectionGrid');
  const empty = document.getElementById('collectionEmpty');

  document.getElementById('collectionBadge').textContent = collection.length;

  if (filtered.length === 0) {
    grid.innerHTML = '';
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    grid.innerHTML = filtered.map(s => sneakerCard(s)).join('');
  }
}

function renderWishlist() {
  const wish = sneakers.filter(s => s.wishlist);
  const grid = document.getElementById('wishlistGrid');
  const empty = document.getElementById('wishlistEmpty');
  document.getElementById('wishlistBadge').textContent = wish.length;

  if (wish.length === 0) {
    grid.innerHTML = '';
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    grid.innerHTML = wish.map(s => sneakerCard(s)).join('');
  }
}

function sneakerCard(s) {
  const tags = (s.tags || '').split(',').map(t=>t.trim()).filter(Boolean);

  return `
    <div class="card" onclick="openDetail('${s.id}')">
      ${s.wishlist ? '<div class="wishlist-badge">‚ù§Ô∏è</div>' : ''}
      ${s.photo
        ? `<img class="card-img" src="${s.photo}" alt="${s.model}">`
        : `<div class="card-img-placeholder">üëü</div>`}
      <div class="card-body">
        <div class="card-brand">${s.brand || '‚Äî'}</div>
        <div class="card-model">${s.model || 'Unknown Model'}</div>
        <div class="card-colorway">${s.colorway || ''}</div>
        ${tags.length ? `<div class="card-tags">${tags.slice(0,3).map(t=>`<span class="tag">${t}</span>`).join('')}</div>` : ''}
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ DETAIL VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openDetail(id) {
  const s = sneakers.find(x => x.id === id);
  if (!s) return;
  const tags = (s.tags || '').split(',').map(t=>t.trim()).filter(Boolean);

  document.getElementById('detailContent').innerHTML = `
    ${s.photo
      ? `<img class="detail-hero" src="${s.photo}" alt="${s.model}">`
      : `<div class="detail-hero-placeholder">üëü</div>`}
    <div class="modal-header" style="padding-top:20px;">
      <span></span>
      <button class="modal-close" onclick="closeModal('detailModal')">‚úï</button>
    </div>
    <div class="modal-body" style="padding-top:8px;">
      <div class="detail-brand">${s.brand || ''}</div>
      <div class="detail-name">${s.model || 'Unknown Model'}</div>
      <div class="detail-colorway">${s.colorway || ''}</div>

      ${tags.length ? `
      <div class="detail-section">
        <h4>Tags</h4>
        <div class="card-tags">${tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      </div>` : ''}

      ${s.notes ? `
      <div class="detail-section">
        <h4>Notes</h4>
        <div class="detail-note">${s.notes}</div>
      </div>` : ''}

      ${s.barcode ? `
      <div class="detail-section">
        <h4>Barcode / SKU</h4>
        <div class="detail-barcode">${s.barcode}</div>
      </div>` : ''}

      <div style="display:flex;gap:10px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">
        <button class="btn btn-ghost" style="flex:1" onclick="editSneaker('${s.id}')">‚úèÔ∏è Edit</button>
        <button class="btn btn-danger" onclick="deleteSneaker('${s.id}')">üóë Delete</button>
      </div>
    </div>
  `;
  document.getElementById('detailModal').classList.add('open');
}

// ‚îÄ‚îÄ‚îÄ ADD / EDIT MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openAddModal(isWishlist) {
  editingId = null;
  addingWishlist = isWishlist;
  currentPhoto = null;
  clearForm();
  document.getElementById('modalTitle').textContent = isWishlist ? 'ADD TO WISHLIST' : 'ADD SNEAKER';
  document.getElementById('addModal').classList.add('open');
}

function editSneaker(id) {
  closeModal('detailModal');
  const s = sneakers.find(x => x.id === id);
  if (!s) return;
  editingId = id;
  addingWishlist = s.wishlist;
  currentPhoto = s.photo || null;

  document.getElementById('fBrand').value = s.brand || '';
  document.getElementById('fModel').value = s.model || '';
  document.getElementById('fColorway').value = s.colorway || '';
  document.getElementById('fTags').value = s.tags || '';
  document.getElementById('fNotes').value = s.notes || '';

  const area = document.getElementById('photoUploadArea');
  area.innerHTML = currentPhoto
    ? `<img src="${currentPhoto}"><div class="photo-upload-text" style="position:relative;background:rgba(0,0,0,0.5);padding:6px 12px;border-radius:6px;">Change Photo</div>`
    : `<div class="photo-upload-text"><div class="photo-upload-icon">üì∏</div>Click to upload a photo</div>`;

  document.getElementById('modalTitle').textContent = 'EDIT SNEAKER';
  document.getElementById('addModal').classList.add('open');
}

function clearForm() {
  ['fBrand','fModel','fColorway','fTags','fNotes'].forEach(id => document.getElementById(id).value = '');
  aiPhotoData = null; document.getElementById('aiIdentifyBtn').disabled = true; document.getElementById('aiStatus').style.display='none'; document.getElementById('aiPreview').style.display='none'; document.getElementById('photoUploadArea').innerHTML = `<div class="photo-upload-text"><div class="photo-upload-icon">üì∏</div>Click to upload a photo</div>`;
}

function saveSneaker() {
  const brand = document.getElementById('fBrand').value.trim();
  const model = document.getElementById('fModel').value.trim();
  if (!brand || !model) {
    alert('Brand and Model are required.');
    return;
  }

  const data = {
    id: editingId || Date.now().toString(),
    brand,
    model,
    colorway: document.getElementById('fColorway').value.trim(),
    tags: document.getElementById('fTags').value.trim(),
    notes: document.getElementById('fNotes').value.trim(),
    photo: currentPhoto,
    wishlist: addingWishlist,
    dateAdded: editingId ? sneakers.find(s=>s.id===editingId)?.dateAdded : Date.now()
  };

  if (editingId) {
    sneakers = sneakers.map(s => s.id === editingId ? data : s);
  } else {
    sneakers.unshift(data);
  }

  saveSneakers(sneakers);
  closeModal('addModal');
  renderFilterChips();
  renderCollection();
  renderWishlist();
}

function deleteSneaker(id) {
  if (!confirm('Delete this sneaker?')) return;
  sneakers = sneakers.filter(s => s.id !== id);
  saveSneakers(sneakers);
  closeModal('detailModal');
  renderFilterChips();
  renderCollection();
  renderWishlist();
}

// ‚îÄ‚îÄ‚îÄ PHOTO UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handlePhoto(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    currentPhoto = e.target.result;
    const area = document.getElementById('photoUploadArea');
    area.innerHTML = `<img src="${currentPhoto}"><div class="photo-upload-text" style="position:relative;background:rgba(0,0,0,0.5);padding:6px 12px;border-radius:6px;">Change Photo</div>`;
  };
  reader.readAsDataURL(file);
}

// ‚îÄ‚îÄ‚îÄ AI SNEAKER IDENTIFIER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let aiPhotoData = null;

function handleAIPhoto(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    aiPhotoData = e.target.result;
    // Also set it as the main sneaker photo
    currentPhoto = e.target.result;
    const area = document.getElementById('photoUploadArea');
    area.innerHTML = `<img src="${aiPhotoData}"><div class="photo-upload-text" style="position:relative;background:rgba(0,0,0,0.5);padding:6px 12px;border-radius:6px;">Change Photo</div>`;
    // Show preview in AI section
    const preview = document.getElementById('aiPreview');
    preview.src = aiPhotoData;
    preview.style.display = 'block';
    // Enable identify button
    document.getElementById('aiIdentifyBtn').disabled = false;
    setAIStatus('Photo ready ‚Äî tap Identify Sneaker!', 'var(--orange)');
  };
  reader.readAsDataURL(file);
}

function setAIStatus(msg, color) {
  const el = document.getElementById('aiStatus');
  el.textContent = msg;
  el.style.color = color || 'var(--text-dim)';
  el.style.display = 'block';
}

async function identifyWithAI() {
  if (!aiPhotoData) { setAIStatus('Please choose a photo first.', 'var(--red)'); return; }

  const btn = document.getElementById('aiIdentifyBtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ Identifying‚Ä¶';
  setAIStatus('Asking AI to identify your sneaker‚Ä¶', 'var(--orange)');

  try {
    // Strip base64 prefix to get raw data
    const base64 = aiPhotoData.split(',')[1];
    const mediaType = aiPhotoData.split(';')[0].split(':')[1];

    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 300,
        messages: [{
          role: 'user',
          content: [
            {
              type: 'image',
              source: { type: 'base64', media_type: mediaType, data: base64 }
            },
            {
              type: 'text',
              text: 'Identify this sneaker. Reply ONLY with a JSON object in this exact format, no other text: {"brand":"Nike","model":"Air Force 1","colorway":"White/White"}. If you cannot identify it, use your best guess based on visible design elements.'
            }
          ]
        }]
      })
    });

    const data = await response.json();
    const text = data.content?.[0]?.text || '';

    // Parse JSON from response
    const match = text.match(/\{[^}]+\}/);
    if (match) {
      const result = JSON.parse(match[0]);
      if (result.brand) document.getElementById('fBrand').value = result.brand;
      if (result.model) document.getElementById('fModel').value = result.model;
      if (result.colorway) document.getElementById('fColorway').value = result.colorway;
      setAIStatus(`‚úÖ Identified: ${result.brand} ${result.model} ‚Äî ${result.colorway}`, 'var(--green)');
    } else {
      setAIStatus('Could not parse result. Try a clearer photo.', 'var(--red)');
    }
  } catch(err) {
    setAIStatus('AI identification failed. Fill in manually.', 'var(--red)');
  }

  btn.disabled = false;
  btn.textContent = '‚ú® Identify Again';
}

// ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderStats() {
  const collection = sneakers.filter(s => !s.wishlist);
  const wishCount = sneakers.filter(s => s.wishlist).length;
  const tagMap = {};
  collection.forEach(s => {
    (s.tags||'').split(',').map(t=>t.trim()).filter(Boolean).forEach(t => {
      tagMap[t] = (tagMap[t]||0)+1;
    });
  });
  const topTag = Object.entries(tagMap).sort((a,b)=>b[1]-a[1])[0]?.[0] || '‚Äî';

  document.getElementById('statsGrid').innerHTML = `
    <div class="stat-card orange">
      <div class="stat-icon">üëü</div>
      <div class="stat-val">${collection.length}</div>
      <div class="stat-label">Total Pairs</div>
    </div>
    <div class="stat-card blue">
      <div class="stat-icon">üè∑Ô∏è</div>
      <div class="stat-val">${Object.keys(new Set(collection.map(s=>s.brand))).length || [...new Set(collection.map(s=>s.brand).filter(Boolean))].length}</div>
      <div class="stat-label">Brands</div>
    </div>
    <div class="stat-card purple">
      <div class="stat-icon">‚ù§Ô∏è</div>
      <div class="stat-val">${wishCount}</div>
      <div class="stat-label">On Wishlist</div>
    </div>
    <div class="stat-card green">
      <div class="stat-icon">üîñ</div>
      <div class="stat-val" style="font-size:1.4rem">${topTag}</div>
      <div class="stat-label">Top Tag</div>
    </div>
  `;

  // Brand chart
  const brandMap = {};
  collection.forEach(s => {
    const b = s.brand || 'Unknown';
    brandMap[b] = (brandMap[b] || 0) + 1;
  });
  const sorted = Object.entries(brandMap).sort((a,b) => b[1]-a[1]).slice(0, 7);
  const max = sorted[0]?.[1] || 1;

  document.getElementById('brandChart').innerHTML = sorted.length ? sorted.map(([brand, count]) => `
    <div class="brand-bar-row">
      <div class="brand-bar-label">${brand}</div>
      <div class="brand-bar-track">
        <div class="brand-bar-fill" style="width:${(count/max*100).toFixed(1)}%"></div>
      </div>
      <div class="brand-bar-count">${count}</div>
    </div>
  `).join('') : '<p style="color:var(--text-dim);font-size:0.9rem;">Add sneakers to see brand breakdown.</p>';
}

// ‚îÄ‚îÄ‚îÄ MODAL HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
  
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) closeModal(overlay.id);
  });
});

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderFilterChips();
renderCollection();
renderWishlist();
</script>
</body>
</html>
